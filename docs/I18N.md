# Internationalization (i18n) Guide

## Overview

Sage's Love AIは i18next を使用して7言語をサポートしています。

## Supported Languages

| Code | Language | Native Name | RTL | Status |
|------|----------|-------------|-----|--------|
| `ja` | Japanese | 日本語 | No | Complete |
| `en` | English | English | No | Complete (Fallback) |
| `es` | Spanish | Español | No | Complete |
| `pt` | Portuguese | Português | No | Complete |
| `fr` | French | Français | No | Complete |
| `hi` | Hindi | हिन्दी | No | Complete |
| `ar` | Arabic | العربية | Yes | Complete |

## File Structure

```
src/lib/
├── i18n.ts                    # i18next configuration
└── locales/
    ├── ja/translation.ts      # Japanese
    ├── en/translation.ts      # English (fallback)
    ├── es/translation.ts      # Spanish
    ├── pt/translation.ts      # Portuguese
    ├── fr/translation.ts      # French
    ├── hi/translation.ts      # Hindi
    └── ar/translation.ts      # Arabic
```

## Translation File Format

各翻訳ファイルは TypeScript モジュールとして定義されています:

```typescript
// src/lib/locales/en/translation.ts
export default {
  // Basic UI
  "appName": "Sage's Love (AI)",
  "appSubtitle": "Speak with the Sage and find your heart's guide.",
  "welcomeMessage": "Welcome, seeker of truth.",

  // Buttons
  "sendButton": "Send",
  "sendingButton": "Sending...",
  "closeButton": "Close",
  "cancelButton": "Cancel",

  // Chat
  "chatPlaceholder": "Enter what you wish to ask the Sage...",
  "sageIsResponding": "The Sage is preparing a response",

  // Errors
  "errorPrefix": "Error",
  "errorMessageDefault": "An unexpected error occurred.",
  "errorAuth": "It seems there is an issue connecting to the service...",
  "errorQuota": "It appears many are seeking wisdom at this moment...",
  "errorGeneric": "A problem arose while weaving words of wisdom...",

  // Nested objects for grouped translations
  "errorBoundary": {
    "genericError": "An unexpected error occurred",
    "retryButton": "Retry",
    "reloadButton": "Reload Page"
  },

  // Long text (use template literals)
  "comprehensiveDisclaimer": `【IMPORTANT DISCLAIMER】

    **1. AI-Generated Content**
    Responses from this application are generated by AI...`,
};
```

## Adding a New Language

### Step 1: Create Translation File

```bash
# Create new translation file
cp src/lib/locales/en/translation.ts src/lib/locales/ko/translation.ts
```

### Step 2: Translate Content

```typescript
// src/lib/locales/ko/translation.ts
export default {
  "appName": "현자의 사랑 (AI)",
  "appSubtitle": "현자와 대화하고 마음의 안내를 찾으세요.",
  "welcomeMessage": "진리를 찾는 자여, 환영합니다.",
  // ... translate all keys
};
```

### Step 3: Register in i18n Configuration

```typescript
// src/lib/i18n.ts
import koTranslation from './locales/ko/translation';

const resources = {
  // ... existing languages
  ko: {
    translation: koTranslation
  }
};
```

### Step 4: Update Language Selector

```typescript
// src/components/LanguageSelector.tsx
const languages = [
  { code: 'ja', name: '日本語' },
  { code: 'en', name: 'English' },
  { code: 'es', name: 'Español' },
  { code: 'pt', name: 'Português' },
  { code: 'fr', name: 'Français' },
  { code: 'hi', name: 'हिन्दी' },
  { code: 'ar', name: 'العربية' },
  { code: 'ko', name: '한국어' },  // Add new language
];
```

### Step 5: Add Crisis Detection Keywords (Optional)

危機検出を新しい言語でも機能させるには:

```typescript
// src/services/crisisDetectionService.ts
const CRISIS_KEYWORDS = {
  // ... existing languages
  ko: {
    suicide: ['자살', '죽고 싶다', '끝내고 싶다'],
    selfHarm: ['자해', '상처 입히고 싶다'],
    despair: ['희망이 없다', '절망'],
    isolation: ['혼자다', '외롭다']
  }
};

const CRISIS_RESOURCES = {
  // ... existing languages
  ko: {
    emergency: '119',
    helpline: '자살예방상담전화 1393',
    resources: [
      '정신건강위기상담전화: 1577-0199',
      '생명의전화: 1588-9191'
    ]
  }
};
```

## Using Translations in Components

### Basic Usage

```tsx
import { useTranslation } from 'react-i18next';

function MyComponent() {
  const { t } = useTranslation();

  return (
    <div>
      <h1>{t('appName')}</h1>
      <p>{t('welcomeMessage')}</p>
    </div>
  );
}
```

### Nested Keys

```tsx
// Access nested translations
{t('errorBoundary.genericError')}
{t('errorBoundary.retryButton')}
```

### With Variables

```tsx
// Translation file
{
  "retryInfo": "Retry {{current}}/{{max}} times"
}

// Component
{t('retryInfo', { current: 1, max: 3 })}
// Output: "Retry 1/3 times"
```

### Language Switching

```tsx
import { useTranslation } from 'react-i18next';

function LanguageSwitch() {
  const { i18n } = useTranslation();

  const changeLanguage = (lang: string) => {
    i18n.changeLanguage(lang);
  };

  return (
    <select onChange={(e) => changeLanguage(e.target.value)}>
      <option value="ja">日本語</option>
      <option value="en">English</option>
      {/* ... */}
    </select>
  );
}
```

### Current Language Detection

```tsx
const { i18n } = useTranslation();

// Get current language
const currentLang = i18n.language; // e.g., "en"

// Check if RTL
const isRTL = i18n.language === 'ar';
```

## RTL (Right-to-Left) Support

アラビア語などのRTL言語をサポートするための設定:

```tsx
// App.tsx
import { useTranslation } from 'react-i18next';

function App() {
  const { i18n } = useTranslation();
  const isRTL = i18n.language === 'ar';

  return (
    <div dir={isRTL ? 'rtl' : 'ltr'}>
      {/* App content */}
    </div>
  );
}
```

### CSS Considerations

```css
/* RTL-aware styles */
[dir="rtl"] .icon-left {
  transform: scaleX(-1);
}

[dir="rtl"] .text-align-left {
  text-align: right;
}
```

## i18n Configuration

```typescript
// src/lib/i18n.ts
import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';
import LanguageDetector from 'i18next-browser-languagedetector';

i18n
  .use(LanguageDetector)
  .use(initReactI18next)
  .init({
    resources,
    fallbackLng: 'en',
    interpolation: {
      escapeValue: false, // React already escapes
    },
    detection: {
      // Language detection order
      order: [
        'querystring',
        'cookie',
        'localStorage',
        'sessionStorage',
        'navigator',
        'htmlTag'
      ],
      // Caching
      caches: ['localStorage', 'cookie'],
    },
  });
```

## Translation Keys Reference

### UI Elements

| Key | Description |
|-----|-------------|
| `appName` | Application name |
| `appSubtitle` | Subtitle under name |
| `welcomeMessage` | Initial greeting |
| `chatPlaceholder` | Input placeholder |
| `sendButton` | Send button text |
| `sendingButton` | Sending state text |
| `closeButton` | Close button text |
| `cancelButton` | Cancel button text |

### Error Messages

| Key | Description |
|-----|-------------|
| `errorPrefix` | Error prefix text |
| `errorMessageDefault` | Default error message |
| `errorAuth` | Authentication error |
| `errorQuota` | Quota exceeded |
| `errorGeneric` | Generic error |
| `errorRateLimit` | Rate limit error |
| `errorTimeout` | Timeout error |

### Modal Content

| Key | Description |
|-----|-------------|
| `comprehensiveDisclaimer` | Full disclaimer text |
| `privacyPolicy` | Privacy policy content |
| `termsOfService` | Terms of service content |
| `helpModalTitle` | Help modal title |

### Error Boundary

| Key | Description |
|-----|-------------|
| `errorBoundary.genericError` | Generic error title |
| `errorBoundary.chunkLoadError` | Chunk load failure |
| `errorBoundary.retryButton` | Retry button |
| `errorBoundary.reloadButton` | Reload button |

## Best Practices

### 1. Key Naming

```typescript
// Good - descriptive and hierarchical
"chat.input.placeholder"
"error.network.timeout"
"modal.disclaimer.title"

// Avoid - vague or flat
"text1"
"message"
"title"
```

### 2. Avoid Hardcoded Text

```tsx
// Bad
<button>Submit</button>

// Good
<button>{t('submitButton')}</button>
```

### 3. Handle Missing Translations

```typescript
// i18n.ts
i18n.init({
  fallbackLng: 'en',
  returnEmptyString: false,
  returnNull: false,
});
```

### 4. Test All Languages

```bash
# Run tests with different languages
npm test -- --env LANG=ja
npm test -- --env LANG=ar
```

### 5. Keep Translations Consistent

- Use the same terminology across all languages
- Maintain similar text lengths where possible
- Consider cultural differences in phrasing

## Troubleshooting

### Translation Not Showing

1. Check if the key exists in the translation file
2. Verify the language is properly registered in i18n.ts
3. Clear localStorage and refresh

### Language Not Persisting

```typescript
// Check detection settings
detection: {
  caches: ['localStorage', 'cookie'],
}
```

### RTL Layout Issues

1. Verify `dir="rtl"` is set on the root element
2. Check CSS for hardcoded `left`/`right` values
3. Use logical properties (`margin-inline-start` instead of `margin-left`)
